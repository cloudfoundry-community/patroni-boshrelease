global
    daemon
    maxconn 256

defaults
    mode tcp
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

{{range $index, $name := ls "/routing/allocation"}}
{{$leader_host := (printf "/cluster/%s/leader/host" $name | getv)}}
{{$leader_port := (printf "/cluster/%s/leader/port" $name | getv)}}
listen {{$name}}
  mode tcp
  bind *:{{(printf "/routing/allocation/%s" $name | getv)}}
  server leader {{$leader_host}}:{{$leader_port}}
{{end}}
