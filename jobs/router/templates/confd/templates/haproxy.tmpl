global
	maxconn 100

defaults
	log	global
	mode	tcp
	retries 2
	timeout client 30m
	timeout connect 4s
	timeout server 30m
	timeout check 5s

listen dummy
  mode tcp
  bind *:60000
  server leader 127.0.0.1:60000

{{if exists "/routing/allocation"}}
	{{range $index, $name := ls "/routing/allocation"}}
		{{if exists (printf "/cluster/%s/leader/host" $name)}}
			{{$leader_host := (printf "/cluster/%s/leader/host" $name | getv)}}
			{{$leader_port := (printf "/cluster/%s/leader/port" $name | getv)}}
listen {{$name}}
  mode tcp
  bind *:{{(printf "/routing/allocation/%s" $name | getv)}}
  server leader {{$leader_host}}:{{$leader_port}}
		{{end}}
	{{end}}
{{end}}
