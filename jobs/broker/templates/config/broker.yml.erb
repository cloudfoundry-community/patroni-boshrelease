---
broker:
  username: <%= p("servicebroker.username") %>
  password: <%= p("servicebroker.password") %>
  port: <%= p("servicebroker.port") %>
  bind_host: <%= p("servicebroker.router.hostname") %>

cells:
<% p("servicebroker.backends.machines").each do |az, machines| %>
  <% machines.each do |machine| %>
- guid: <%= machine %>
  availability_zone: <%= az %>
  uri: <%= machine %>
  username: "<%= p('servicebroker.backends.username') %>"
  password: "<%= p('servicebroker.backends.password') %>"
  <% end %>
<% end %>

etcd:
  machines: <%= p("etcd.machines").map {|h| "http://#{h}:4001"} %>

<% if_p("backups.clusterdata.aws_access_key_id") do |aws_access_key_id| %>
callbacks:
  clusterdata_backup: {cmd: /var/vcap/jobs/broker/bin/backup_provisioned_service}
  clusterdata_restore: {cmd: /var/vcap/jobs/broker/bin/restore_provisioned_service}
<% end %>

catalog:
  services: <%= JSON.pretty_generate(p('servicebroker.services')) %>
