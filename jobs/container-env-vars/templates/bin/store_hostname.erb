#!/bin/bash

set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables

env_var_path=$1
if [[ -z "$env_var_path" ]]; then
  echo "Usage: $0 /var/vcap/store/cf-containers-broker/direnv/DOCKER_HOSTNAME"
  exit 1
fi
mkdir -p $(dirname $env_var_path)

# hostname matches registrator job's data/properties.sh.erb
export DOCKER_HOSTNAME="<%= index %>.<%= name %>.<%= spec.networks.methods(false).grep(/[^=]$/).first.to_s %>.<%= spec.deployment %>.<%= spec.dns_domain_name %>"
echo $DOCKER_HOSTNAME > ${env_var_path}
